<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Narukami 管理画面</title>
    <link rel="stylesheet" href="/admin/admin.css">
</head>
<body>
    <!-- ログイン画面 -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h1>Narukami 管理画面</h1>
            <input type="password" id="passwordInput" placeholder="パスワード" class="password-input">
            <button id="loginButton" class="btn-primary">ログイン</button>
            <div id="loginError" class="error-message" style="display: none;"></div>
        </div>
    </div>

    <!-- メイン画面 -->
    <div id="mainScreen" class="main-screen" style="display: none;">
        <header class="header">
            <h1>Narukami 管理画面</h1>
            <button id="logoutButton" class="btn-secondary">ログアウト</button>
        </header>

        <div class="container">
            <!-- KPIサマリカード -->
            <div class="kpi-cards">
                <div class="kpi-card">
                    <div class="kpi-icon">👤</div>
                    <div class="kpi-content">
                        <div class="kpi-label">総ユーザー数</div>
                        <div class="kpi-value" id="kpiTotalUsers">-</div>
                        <div class="kpi-trend" id="kpiUsersTrend"></div>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">📈</div>
                    <div class="kpi-content">
                        <div class="kpi-label">新規登録（今週）</div>
                        <div class="kpi-value" id="kpiNewUsers">-</div>
                        <div class="kpi-trend" id="kpiNewUsersTrend"></div>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">✉️</div>
                    <div class="kpi-content">
                        <div class="kpi-label">平均開封率</div>
                        <div class="kpi-value" id="kpiOpenRate">-</div>
                        <div class="kpi-trend" id="kpiOpenRateTrend"></div>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">🖱</div>
                    <div class="kpi-content">
                        <div class="kpi-label">平均CTR</div>
                        <div class="kpi-value" id="kpiCtr">-</div>
                        <div class="kpi-trend" id="kpiCtrTrend"></div>
                    </div>
                </div>
            </div>

            <!-- グラフセクション -->
            <div class="charts-section">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>📈 ユーザー推移</h3>
                        <div class="chart-period">
                            <button class="period-btn active" data-period="7d" onclick="loadTrends('users', '7d')">7日</button>
                            <button class="period-btn" data-period="30d" onclick="loadTrends('users', '30d')">30日</button>
                            <button class="period-btn" data-period="90d" onclick="loadTrends('users', '90d')">90日</button>
                        </div>
                    </div>
                    <canvas id="usersChart"></canvas>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <h3>📊 通知パフォーマンス（直近10件）</h3>
                    </div>
                    <canvas id="notificationsChart"></canvas>
                </div>
            </div>

            <div class="actions">
                <a href="/admin/create" class="btn-primary">+ 新規通知作成</a>
                <a href="/admin/sequences" class="btn-primary" style="background: #ff9800; text-decoration: none;">📊 ステップ配信管理</a>
                <a href="/admin/managed" class="btn-primary" style="background: #9c27b0; text-decoration: none;">🏢 フルマネージド管理</a>
            </div>

            <div class="notifications-section">
                <h2>通知一覧</h2>
                <div id="notificationsList" class="notifications-list">
                    <p class="loading">読み込み中...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="/admin/admin.js"></script>
</body>
</html>
