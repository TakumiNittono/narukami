# 05. 画面仕様書

## 画面一覧

| # | 画面名 | パス | 対象者 | 認証 |
|---|---|---|---|---|
| 1 | LP / 初期画面 | `/` | ユーザー | なし |
| 2 | 登録完了画面 | `/thanks` | ユーザー | なし |
| 3 | 管理画面（通知一覧） | `/admin` | 管理者 | パスワード認証 |
| 4 | 通知作成画面 | `/admin/create` | 管理者 | パスワード認証 |

---

## 1. LP / 初期画面（`/`）

### 目的
- 通知許可を取得する
- PWAとしてホーム画面に追加させる

### ワイヤーフレーム

```
┌─────────────────────────┐
│        [アイコン]         │
│                         │
│    サービス名            │
│    Narukami              │
│                         │
│  ───────────────────    │
│                         │
│  📱 最新情報をプッシュ    │
│  通知でお届けします       │
│                         │
│  ・新着情報をすぐにキャッチ │
│  ・設定カンタン、1タップ   │
│  ・いつでも解除OK         │
│                         │
│  ┌─────────────────┐    │
│  │  通知を受け取る 🔔  │    │
│  └─────────────────┘    │
│                         │
│  ───────────────────    │
│                         │
│  📲 iPhoneの方へ         │
│  ① 下の共有ボタン ⬆ を   │
│    タップ                │
│  ② 「ホーム画面に追加」   │
│    を選択                │
│  ③ 追加したアイコンから   │
│    開き直してください     │
│                         │
│  [説明画像]              │
│                         │
└─────────────────────────┘
```

### 要素詳細

| # | 要素 | 種類 | 動作 |
|---|---|---|---|
| 1 | サービスアイコン | 画像 | - |
| 2 | サービス名・説明文 | テキスト | - |
| 3 | 「通知を受け取る」ボタン | ボタン | クリック → 通知許可ダイアログ → トークン登録 → /thanks へ遷移 |
| 4 | iPhone向け説明 | テキスト+画像 | PWAインストール手順の説明 |

### 処理フロー

```
[ボタンクリック]
    │
    ▼
[ブラウザの通知許可ダイアログ表示]
    │
    ├── 許可 → FCMトークン取得
    │          │
    │          ▼
    │   [POST /api/register-token]
    │          │
    │          ▼
    │   [/thanks に遷移]
    │
    └── 拒否 → エラーメッセージ表示
               「通知を受け取るには許可が必要です」
```

### 状態分岐

| 条件 | 表示 |
|---|---|
| PWA未インストール（Safari） | iPhone説明セクション表示 |
| PWA未インストール（Chrome） | Android向け「インストール」バナー自動表示 |
| PWAインストール済み | 通知許可ボタンのみ表示 |
| 通知許可済み | ボタンを「登録済みです ✓」に変更（disabled） |
| iOS非PWAモード | 「ホーム画面に追加してから通知を許可してください」 |

### 重要: iOSの制約

- **iOS Safariではブラウザから直接Push通知を許可できない**
- PWA（ホーム画面に追加）としてのみ通知許可が可能
- そのため、PWA未インストール時は「ホーム画面に追加」手順を優先表示する

---

## 2. 登録完了画面（`/thanks`）

### 目的
- 登録完了を明確に伝える
- ユーザーに余計な操作をさせない

### ワイヤーフレーム

```
┌─────────────────────────┐
│                         │
│         ✅              │
│                         │
│   登録が完了しました！    │
│                         │
│   プッシュ通知で          │
│   最新情報をお届けします   │
│                         │
│   この画面は             │
│   閉じていただいてOKです   │
│                         │
└─────────────────────────┘
```

### 注意
- リンクやボタンは **一切置かない**
- ユーザーの離脱を促す（操作完了のため）

---

## 3. 管理画面 - 通知一覧（`/admin`）

### 認証
管理画面アクセス時にパスワード入力を求める。
入力されたパスワードは `localStorage` に保存し、API呼び出し時に `Authorization: Bearer パスワード` ヘッダーとして送信する。

### ワイヤーフレーム

#### ログイン画面（初回 or パスワード未保存時）
```
┌──────────────────────────────────────┐
│                                      │
│      Narukami 管理画面                 │
│                                      │
│  パスワード                            │
│  ┌──────────────────────────────┐    │
│  │ ••••••••                      │    │
│  └──────────────────────────────┘    │
│                                      │
│  ┌──────────┐                        │
│  │  ログイン  │                        │
│  └──────────┘                        │
│                                      │
└──────────────────────────────────────┘
```

#### メイン画面（認証後）
```
┌──────────────────────────────────────┐
│  Narukami 管理画面           [ログアウト] │
│  登録ユーザー数: 156人                  │
├──────────────────────────────────────┤
│                                      │
│  [+ 新規通知作成]                      │
│                                      │
│  ─── 通知一覧 ─────────────────────   │
│                                      │
│  📋 #5 | 2026/02/10 09:00            │
│  タイトル: 週末セールのお知らせ          │
│  本文: 今週末は全品20%OFF...           │
│  URL: https://example.com/sale        │
│  状態: ⏳ 予約済み                     │
│  [テスト送信]                          │
│                                      │
│  ──────────────────────────────────   │
│                                      │
│  📋 #4 | 2026/02/08 12:00            │
│  タイトル: 新商品入荷しました           │
│  本文: お待たせしました...             │
│  URL: https://example.com/new         │
│  状態: ✅ 送信済み                     │
│                                      │
└──────────────────────────────────────┘
```

### 要素詳細

| # | 要素 | 動作 |
|---|---|---|
| 1 | 登録ユーザー数 | `GET /api/stats` で取得して表示 |
| 2 | 新規通知作成ボタン | `/admin/create` へ遷移 |
| 3 | 通知一覧 | `GET /api/notifications/list` で取得 |
| 4 | 状態バッジ | ⏳予約済み / ✅送信済み |
| 5 | テスト送信ボタン | `POST /api/send-notification` で即時送信 |
| 6 | ログアウト | localStorage からパスワード削除 |

---

## 4. 通知作成画面（`/admin/create`）

### ワイヤーフレーム

```
┌──────────────────────────────────────┐
│  通知作成                              │
├──────────────────────────────────────┤
│                                      │
│  タイトル                              │
│  ┌──────────────────────────────┐    │
│  │ 週末セールのお知らせ            │    │
│  └──────────────────────────────┘    │
│  ※ 最大100文字                        │
│                                      │
│  本文                                 │
│  ┌──────────────────────────────┐    │
│  │ 今週末は全品20%OFFで          │    │
│  │ お買い得です！                  │    │
│  │ ぜひチェックしてください         │    │
│  └──────────────────────────────┘    │
│  ※ 2〜3行推奨                         │
│                                      │
│  タップ時のURL（省略可）               │
│  ┌──────────────────────────────┐    │
│  │ https://example.com/sale      │    │
│  └──────────────────────────────┘    │
│                                      │
│  送信日時                              │
│  ┌──────────────────────────────┐    │
│  │ 2026-02-10T09:00              │    │
│  └──────────────────────────────┘    │
│                                      │
│  ┌──────────┐  ┌──────────┐         │
│  │ 予約作成   │  │  戻る     │         │
│  └──────────┘  └──────────┘         │
│                                      │
└──────────────────────────────────────┘
```

### フォーム項目

| # | 項目名 | 入力タイプ | 必須 | バリデーション |
|---|---|---|---|---|
| 1 | タイトル | text | ○ | 1〜100文字 |
| 2 | 本文 | textarea | ○ | 1〜500文字 |
| 3 | URL | url | × | URL形式チェック（入力時） |
| 4 | 送信日時 | datetime-local | ○ | 現在時刻より未来 |

### 送信後の動作
1. クライアントサイドバリデーション実行
2. `POST /api/notifications/create` を呼び出し
3. 管理画面（一覧）にリダイレクト
4. 「通知を作成しました」メッセージ表示

---

## デザイン方針

### ユーザー向け画面
- **シンプル・クリーン**なデザイン
- 余白を十分に取る
- ボタンは大きく、タップしやすく
- フォントサイズは大きめ（16px以上）
- 色数は最小限（メインカラー1色 + 白 + グレー）

### 管理画面
- **機能優先**のシンプルなデザイン
- 装飾不要、情報が読みやすければOK
- レスポンシブ（スマホからも操作可能）
- SPA風（HTML + fetch APIでAPI呼び出し）

### 共通
- フレームワーク不使用（バニラHTML/CSS/JS）
- モバイルファースト
- ダークモード非対応（MVP）
